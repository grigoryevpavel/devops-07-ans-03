# Сервера Clickhouse, Vector и система управления БД Lighthouse

## 1. Развертывание сервера Clickhouse

Плей Clickhouse устанавливает клиента и сервер clickhouse. Плей расположен в одноименном файле [clickhouse.yml](clickhouse.yml). 
В плее используются следующие переменные:
- clickhouse_version. Задает скачиваемую версию clickhouse клиента и сервера.
- clickhouse_packages. Задает список устанавливаемых пакетов. По умолчанию равен списку из clickhouse-client и clickhouse-server
В плее использованы следующие теги для ускоренной отладки или частичной установки:
- clickhouse. Позволяет установить clickhouse не устанавливая обязательные пакеты. Данный вид установки удобен если точно известно, что на ВМ уже установлены:
  1. apt-transport-https
  2. ca-certificates
  3. dirmngr

## 2. Развертывание сервера vector для анализа метрических данных

Плей Vector устанавливает среду анализа и трансформации метрических данных Vector. Плей расположен в одноименном файле [vector.yml](vector.yml).
В плее vector используются следующие переменные:
- vector_hostname  задает адрес хоста на котором будет запущен и доступен сервер vector. По умолчанию это локальный хост(127.0.0.1)
- vector_port задает порт на котором будет отвечать сервер vector. По умолчанию порт равен 8686.
- vector_dest задает папку в которую будет скопирован установочный скрипт.
- vector_user задает имя пользователя под которым будет скачиваться устанавочный скрипт
Для ускорения отладки и частичного исполнения плея использованы следующие теги:
- vectorconfig. Данный тег позволяет произвести дополнительную настройку сервера vector без его установки. Полезно, если сервер уже был ранее установлен и требуется его дополнительная настройка.

## 3. Развертывание системы управления БД lighthouse

Плей lighthouse устанавливает среду управления БД clickhouse. Плей находится в файле [lighthouse.yml](lighthouse.yml)
В плее lighthouse используются следующие переменные:
- lighthouse_dest задает папку куда будет закачана и равернута административная панель lighthouse. По умолчанию это папка /home/administrator/lighthouse
- hostname  задает имя хоста на котором будет доступна административная панель lighthouse. По умолчанию административная панель доступна только с самого сервера по адресу 127.0.0.1
- hostport задает порт на котором будет доступна администравная панель lighthouse. По умолчанию значение равно 8080
Для ускорения отладки и частичного исполнения плея используются следующие теги:
- ngix - Устанавливает веб-сервер nginx версии 1.18.0.
- git - Устанавливает git
- lighthouse - Скачивает и конфигурирует на сервере ngix административную панель lighthouse
- lighthouse_conf - Только конфигурирует административную панель lighthouse, что удобно при обновлении конфигурации.

## 4. Итог

Общая установка осуществляется плеем [site.yml](site.yml). Для запуска плея используется инвенторифайл [prod.yml](inventory/prod.yml):

**ansible-playbookk -i inventory/prod.yml --private-key <key file name> site.yml**

